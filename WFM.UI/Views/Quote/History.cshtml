@model WFM.DAL.Quote

@{
    ViewBag.Title = "Quote";
    ViewBag.ButtonLink = "'/Quote/Details'";
}

<style>

    @@media screen {
        #printSection {
            display: none;
        }
    }

    @@media print {
        body * {
            visibility: hidden;
        }

        #printSection, #printSection * {
            visibility: visible;
        }

        #printSection {
            position: absolute;
            left: 10px;
            top: 0;
        }
    }
</style>

<div class="dashboard-ecommerce">
    <div class="container-fluid dashboard-content ">
        <!-- ============================================================== -->
        <!-- pageheader  -->
        <!-- ============================================================== -->
        @Html.Partial("_PageHeaderPartial")
        <!-- ============================================================== -->
        <!-- end pageheader  -->
        <!-- ============================================================== -->
        <div class="border border-primary bg-actual-white  m-b-10">
            <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12 m-t-20">
                <div class="table-responsive">
                    <table id="List" class="table table-striped table-bordered first">
                        <thead>
                            <tr>
                                <th>Code</th>
                                <th>Client</th>
                                <th>Value</th>
                                <th>Version</th>
                                <th>Created Date (DD/MM/YYYY)</th>
                                <th></th>
                            </tr>
                        </thead>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="reportModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Sign Tech Report</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body" id="Preview">
                @Html.Partial("_PrintQuote")
            </div>
            <div class="modal-footer">
                <button id="btnPrint" type="button" class="btn btn-primary">Print</button>
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>


<script type="text/javascript">
    $(document).ready(function () {
        LoadQuotes();
    });

    document.getElementById("btnPrint").onclick = function () {
        printElement(document.getElementById("printThis"));
    }

    function printElement(elem) {
        var domClone = elem.cloneNode(true);

        var $printSection = document.getElementById("printSection");

        if (!$printSection) {
            var $printSection = document.createElement("div");
            $printSection.id = "printSection";
            document.body.appendChild($printSection);
        }

        $printSection.innerHTML = "";
        $printSection.appendChild(domClone);
        window.print();
    }

    function PrintQuote(id) {
        $.ajax({
            type: "GET",
            url: '@Url.Action("PrintQuote", "Quote")',
            data: { id: id },
            success: function (data) {
                $('#Preview').html(data);
                $('#reportModal').modal('show');
            }
        })
    }

    function LoadQuotes() {

        if ($.fn.dataTable.isDataTable('#List')) {
            table = $('#List').DataTable();
            table.destroy();
        }

        $('#List').DataTable({
            "createdRow": function (row, data, dataIndex) {
                //console.log(data);
                if (data.IsApproved == true) {

                }
            },
            "ajax": {
                "url": "/Quote/GetHistoryList",
                "type": "POST",
                "datatype": "json"
            },
            "columns": [
                { "data": "Code", "width": "10%" },
                { "data": "ClientName", "width": "50%" },
                { "data": "Value", "width": "10%" },
                { "data": "Version", "width": "10%" },
                { "data": "CreatedDateString", "width": "20%" },
                {
                    "data": "Id", "searchable": false, "ordering": false, "sorting": false,
                    "render": function (data, type, full, meta) {
                        return '<a class="btn btn-secondary btn-xs" onclick="PrintQuote(' + data + ')">View</a>';
                    }
                },
            ]
        });

    }
</script>


@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")
}

