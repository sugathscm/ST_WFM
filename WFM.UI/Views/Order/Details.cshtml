@model WFM.DAL.Order
@using WFM.DAL
@{

    ViewBag.Title = "Order Details";
}
@{
    string IsFactory = (User.IsInRole("Factory")) ? "active show" : "";
    string IsOtherRole = (User.IsInRole("Factory")) ? "" : "active show";
}
<style>

    @@media screen {
        #printSection {
            display: none;
        }
    }

    @@media (min-width: 992px) {
        .modal-dialog {
            max-width: 60%;
        }
    }

    @@media print {
        body * {
            visibility: hidden;
        }

        #printSection, #printSection * {
            visibility: visible;
        }

        #printSection {
            position: absolute;
            left: 10px;
            top: 0;
        }
    }

    table.report-container {
        page-break-after: always;
    }

    thead.report-header {
        display: table-header-group;
    }

    tfoot.report-footer {
        display: table-footer-group;
    }

    tr {
        page-break-inside: avoid;
        page-break-after: auto
    }
</style>
<div class="dashboard-ecommerce">
    <div class="container-fluid dashboard-content ">
        <!-- ============================================================== -->
        <!-- pageheader  -->
        <!-- ============================================================== -->
        @Html.Partial("_PageHeaderPartial")
        <!-- ============================================================== -->
        <!-- end pageheader  -->
        <!-- ============================================================== -->
        <div class="border border-primary bg-actual-white">
            <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12 m-b-10">
                @using (Html.BeginForm("SaveOrUpdate", "Order", FormMethod.Post, new { id = "OrderForm", @class = "needs-validation", role = "form", enctype = "multipart/form-data", onsubmit = "return readValues();" }))
                {
                    @*<form class="needs-validation" novalidate="">*@
                    @Html.AntiForgeryToken()
                    @Html.ValidationSummary("", new { @class = "valFailure" })
                    @Html.HiddenFor(m => m.Id, new { @name = "Id" })

                    //hidden Variables
                    <input type="hidden" name="productIdArray" value="" id="productIdArray" />
                    <input type="hidden" name="itmqtyArray" value="" id="itmqtyArray" />
                    <input type="hidden" name="descriptionArray" value="" id="descriptionArray" />
                    <input type="hidden" name="SpecialInstructionsArray" value="" id="SpecialInstructionsArray" />
                    <input type="hidden" name="installationArray" value="" id="installationArray" />
                    <input type="hidden" name="channeledByArray" value="" id="channeledByArray" />
                    <input type="hidden" name="itmcostArray" value="" id="itmcostArray" />
                    <input type="hidden" name="itmtotCostArray" value="" id="itmtotCostArray" />
                    <input type="hidden" name="vatArray" value="" id="vatArray" />
                    <input type="hidden" name="sizeArray" value="" id="sizeArray" />
                    <input type="hidden" name="VATPercentage" value="@ViewBag.VATPercentage" id="VATPercentage" />
                    <input type="hidden" name="chargeItemArray" value="" id="chargeItemArray" />
                    <input type="hidden" name="chargeCostArray" value="" id="chargeCostArray" />
                    <input type="hidden" name="chargeTotalCostArray" value="" id="chargeTotalCostArray" />
                    <input type="hidden" name="chargeQtyArray" value="" id="chargeQtyArray" />
                    <input type="hidden" name="visibilityArray" value="" id="visibilityArray" />
                    <input type="hidden" name="illuminationArray" value="" id="illuminationArray" />
                    <input type="hidden" name="frameworkWarrantyArray" value="" id="frameworkWarrantyArray" />
                    <input type="hidden" name="letteringWarrantyArray" value="" id="letteringWarrantyArray" />
                    <input type="hidden" name="illuminationWarrantyArray" value="" id="illuminationWarrantyArray" />
                    <input type="hidden" name="item-count" value="1" id="item-count" />
                    <input type="hidden" name="charge-count" value="1" id="charge-count" />

                    <input type="hidden" name="material-count" value="1" id="material-count" />

                    <input type="hidden" name="attachment-count" value="0" id="attachment-count" />
                    <input type="hidden" name="Matattachment-count" value="0" id="Matattachment-count" />
                    <input type="hidden" name="OrdtotCost" value="" id="OrdtotCost" />
                    <input type="hidden" name="AttachmentNameArray" value="" id="AttachmentNameArray" />
                    <input type="hidden" name="MatAttachmentNameArray" value="" id="MatAttachmentNameArray" />
                    <input type="hidden" name="itemIdArray" value="" id="itemIdArray" />
                    <input type="hidden" name="addchrgIdArray" value="" id="addchrgIdArray" />
                    <input type="hidden" name="ordmatIdArray" value="" id="ordmatIdArray" />


                    <input type="hidden" name="MaterialArr" value="" id="MaterialArr" />
                    <input type="hidden" name="SupplierArr" value="" id="SupplierArr" />
                    <input type="hidden" name="AttributeArr" value="" id="AttributeArr" />
                    <input type="hidden" name="ValueArr" value="" id="ValueArr" />

                    <input type="hidden" name="MaterialArrId" value="" id="MaterialArrId" />



                    //Page Start

                    <ul id="tabstrip" class="nav nav-pills nav-justified " role="tablist">
                        @if (!(User.IsInRole("Factory")))
                        {
                            <li class="nav-item">
                                <a class="nav-link active" href="#_FirstTab" role="tab" data-toggle="tab" style="font-size:medium"><b>Order</b></a>
                            </li>

                            <li class="nav-item">

                                <a class="nav-link" href="#_SecondTab" role="tab" data-toggle="tab" style="font-size:medium"><b>Production Details</b></a>
                            </li>

                            <li class="nav-item">

                                <a class="nav-link" id="product" href="#_ThirdTab" role="tab" data-toggle="tab" style="font-size:medium"><b>Payment</b></a>
                            </li>

                            <li class="nav-item">

                                <a class="nav-link" id="FileAttactment" href="#_FourthTab" role="tab" data-toggle="tab" style="font-size:medium"><b>Attachment</b></a>
                            </li>
                        }

                        @if (Model.OrderItems.Count > 0 && (User.IsInRole("Administrator") || User.IsInRole("Factory")))
                        {
                            <li class="nav-item">

                                <a class="nav-link" id="OrderMaterial" href="#_FifthTab" role="tab" data-toggle="tab" style="font-size:medium"><b>Order Material</b></a>
                            </li>

                            <li class="nav-item">

                                <a class="nav-link" id="InstallationDetail" href="#_SixthTab" role="tab" data-toggle="tab" style="font-size:medium"><b>Installation Details</b></a>
                            </li>
                        }


                    </ul>



                    <div class="tab-content">

                        @*-&& (User.IsInRole("Design"))-*@

                        @*---------------FIRSTTAB-------------*@
                        <div class="tab-pane @(IsOtherRole)" id="_FirstTab">
                            <div class="form-row">

                                <div class="col-xl-1 col-lg-2 col-md-6 col-sm-12 col-12 m-t-5">
                                    <label class="control-label" for="OrderTypeId">Type</label>
                                    @Html.DropDownList("OrderTypeId", (SelectList)ViewBag.OrderTypeList, "Select Type", new { @class = "form-control order-type" })
                                </div>
                                <div class="col-xl-1 col-lg-1 col-md-3 col-sm-12 col-12 m-t-5">
                                    <label class="control-label" for="Code">PO Number</label>
                                    @Html.TextBoxFor(m => m.Code, new { @class = "form-control", @readonly = "readonly" })
                                </div>

                                <div class="col-xl-1 col-lg-1 col-md-3 col-sm-12 col-12 m-t-5">
                                    <label class="control-label" for="CreatedDate">Created Date</label>
                                    @Html.TextBoxFor(m => m.CreatedDate, new { @class = "form-control", @disabled = "disabled" })
                                    @Html.ValidationMessageFor(m => m.CreatedDate)
                                </div>

                                <div class="col-xl-2 col-lg-2 col-md-6 col-sm-12 col-12 mb-2 m-t-5">
                                    <label class="control-label" for="ChanneledBy">Channeled By</label>
                                    @* @Html.DropDownList("quoteItem_LetteringWarrantyPeriod", new SelectList(ViewBag.WarrantyPeriodList, "Id", "Duration"), "Lettering", new { @class = "form-control selection" })*@
                                    @Html.DropDownList("ChanneledById", (SelectList)ViewBag.ChanneledByList, "Select Channeled By", new { @class = "form-control selection" })
                                </div>

                                <div class="col-xl-2 col-lg-2 col-md-6 col-sm-12 col-12 mb-2 m-t-5">
                                    <label class="control-label" for="ChanneledBy">Order Status</label>
                                    @if (User.IsInRole("Administrator"))
                                    {
                                        @Html.DropDownList("StatusId", (SelectList)ViewBag.Status, "Select Status", new { @class = "form-control selection" })
                                    }
                                    else
                                    {
                                        @Html.DropDownList("StatusId", (SelectList)ViewBag.Status, "Select Status", new { @class = "form-control selection", @disabled = "disabled", @value = "1" })
                                    }
                                    @* @Html.DropDownList("quoteItem_LetteringWarrantyPeriod", new SelectList(ViewBag.WarrantyPeriodList, "Id", "Duration"), "Lettering", new { @class = "form-control selection" })*@

                                </div>

                            </div>
                            <div class="form-row">
                                <div class="col-xl-3 col-lg-3 col-md-6 col-sm-12 col-12 m-t-5">
                                    <label class="control-label" for="Client"><b>Client</b></label>
                                    @Html.DropDownList("ClientId", (SelectList)ViewBag.ClientList, "Select Client", new { @class = "form-control selection" })
                                    @Html.ValidationMessageFor(model => model.ClientId)
                                </div>
                                <div class="col-xl-1 col-lg-1 col-md-3 col-sm-12 col-12 m-t-5">
                                    <label class="control-label" for="Client">&nbsp;</label><br />
                                    <button type="button" class="btn btn-primary btn-xs full-width" data-toggle="modal" data-target="#exampleModal">
                                        New Client
                                    </button>
                                </div>

                            </div>
                            <div class="form-row">
                                <div class="col-xl-3 col-lg-3 col-md-12 col-sm-12 col-12 m-t-5 ">
                                    <label class="control-label" for="ContactPerson">Contact Person</label>
                                    @Html.TextBoxFor(m => m.ContactPerson, new { @class = "form-control" })
                                </div>
                                <div class="col-xl-2 col-lg-2 col-md-12 col-sm-12 col-12 m-t-5">
                                    <label class="control-label" for="ContactMobile">Contact No.</label>
                                    @Html.TextBoxFor(m => m.ContactMobile, new { @class = "form-control" })
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="col-xl-3 col-lg-3 col-md-6 col-sm-12 col-12 m-t-5">
                                    <label class="control-label" for="Client"><b>Delivery</b></label>
                                    @Html.DropDownList("DeliveryTypeId", (SelectList)ViewBag.DeliveryTypeList, "Delivery option", new { @class = "form-control selection" })
                                </div>


                                <div class="col-xl-2 col-lg-3 col-md-12 col-sm-12 col-12 m-t-5">
                                    <label class="control-label" for="Contact Person">Location</label>
                                    @Html.TextBoxFor(m => m.Location, new { @class = "form-control" })
                                </div>
                                <div class="col-xl-2 col-lg-2 col-md-12 col-sm-12 col-12 m-t-5">

                                    <label class="control-label" for="DeliveryDate">Delivery Date</label>

                                    @Html.TextBoxFor(m => m.DeliveryDate, new { @class = "datepicker" })

                                </div>
                            </div>
                            <div class="form-row">
                                <div class="col-xl-2 col-lg-2 col-md-6 col-sm-12 col-12 m-t-5">
                                    <label class="control-label" for="BaseQuoteId">Quote Number</label>
                                    @Html.DropDownList("BaseQuoteId", (SelectList)ViewBag.QuoteList, "Quote Number", new { @class = "form-control" })
                                </div>
                                <div class="col-xl-2 col-lg-2 col-md-12 col-sm-12 col-12 m-t-5">
                                    <label class="control-label" for="VATNo">VAT Number</label>
                                    @Html.TextBoxFor(m => m.VATNo, new { @class = "form-control" })

                                </div>

                                <div class="col-xl-2 col-lg-2 col-md-12 col-sm-12 col-12 m-t-5">
                                    <label class="control-label" for="Designer">Designer</label>
                                    @Html.TextBoxFor(m => m.Designer, new { @class = "form-control" })
                                </div>

                            </div>
                        </div>
                        @*---------------SecondTAB---------------*@
                        <div class="tab-pane fade" id="_SecondTab">
                            <div id="items" class="m-t-10 m-b-10">

                                @if (Model.OrderItems.Count > 0)
                                {

                                    foreach (var quoteItem in Model.OrderItems)
                                    {
                                        var totwithvat = (quoteItem.UnitCost * quoteItem.Qty) + quoteItem.VAT;
                                        <div class="form-row item m-t-10 m-b-20">
                                            <input type="hidden" id="itemId" class="form-control" value="@quoteItem.Id" />
                                            <div class="col-xl-4 col-lg-4 col-md-4 col-sm-12 col-12 m-t-5" id="HiddenId">

                                                <label class="control-label" for="product"><b>Product</b></label>
                                                @Html.DropDownListFor(m => quoteItem.CategoryId, new SelectList(ViewBag.CategoryList, "Id", "Name", quoteItem.CategoryId), "Product", new { @class = "form-control" })
                                            </div>

                                            <div class="col-md-1 m-t-5">
                                                <label class="control-label" for="Size"><b>Size</b></label>
                                                <input type="text" id="Size" placeholder="Size" class="form-control" value="@quoteItem.Size" />
                                            </div>
                                            <div class="col-xl-1 col-lg-1 col-md-1 m-t-5">
                                                <label class="control-label" for="itmQty"><b>Qty</b></label>
                                                <input type="text" id="itmQty" placeholder="Qty." class="form-control text-right" value="@quoteItem.Qty" />
                                            </div>
                                            <div class="col-xl-1 col-lg-1 col-md-1 m-t-5">
                                                <label class="control-label" for="itmCost"><b>Cost</b></label>
                                                <input type="text" id="itmCost" placeholder="0.00" class="form-control text-right" value="@quoteItem.UnitCost.ToString("#,###,##0.00")" data-type="currency" />
                                            </div>
                                            <div class="col-xl-2 col-lg-1 col-md-1 m-t-5">
                                                <label class="control-label" for="TotalCost"><b>Total Cost</b></label>
                                                <input type="text" id="itmTotalCost" placeholder="Total Cost" class="form-control text-right" readonly="readonly" value="@quoteItem.TotalCost.ToString("#,###,##0.00")" />
                                            </div>
                                            <div class="col-xl-1 col-lg-1 col-md-1 m-t-5">
                                                <label class="control-label" for="VAT"><b>VAT</b></label>
                                                <input type="text" id="VAT" placeholder="VAT" class="form-control text-right" readonly="readonly" value="@quoteItem.VAT.ToString("#,###,##0.00")" />
                                            </div>
                                            <div class="col-xl-2 col-lg-13 col-md-1 m-t-5">
                                                <label class="control-label" for="TotalCostVAT"><b>Total Cost with VAT</b></label>
                                                <input type="text" id="TotalCostVAT" placeholder="Total Cost with VAT" class="form-control text-right" readonly="readonly" value="@totwithvat.ToString("#,###,##0.00")" />
                                            </div>
                                            <div class="col-xl-2 col-lg-1 col-md-6 col-sm-12 col-12 m-t-5">
                                                <label class="control-label" for="Value"><b>Visibility</b></label>
                                                @Html.DropDownListFor(m => quoteItem.VisibilityId, new SelectList(ViewBag.VisibilityList, "Id", "Name", quoteItem.VisibilityId.Value), "Visibility", new { @class = "form-control selection" })
                                            </div>
                                            <div class="col-xl-2 col-lg-1 col-md-6 col-sm-12 col-12 m-t-5">
                                                <label class="control-label" for="Illumination"><b>Illumination</b></label>
                                                @*@Html.DropDownList("IlluminationWarrantyPeriod", (SelectList)ViewBag.WarrantyPeriodList, "Select Illumination", new { @class = "form-control selection" })*@

                                                @Html.DropDownList("quoteItem_Illumination", new SelectList(ViewBag.IlluminationList, "Id", "Name", quoteItem.IlluminationId), "Illumination", new { @class = "form-control selection" })

                                            </div>
                                            <div class="col-xl-1 col-lg-1 col-md-6 col-sm-12 col-12 m-t-5">
                                                <label class="control-label" for="Framework"><b>Framework</b></label>
                                                @Html.DropDownListFor(m => quoteItem.FrameworkWarrantyPeriod, new SelectList(ViewBag.WarrantyPeriodList, "Id", "Duration", quoteItem.FrameworkWarrantyPeriod), "Framework Warranty ", new { @class = "form-control" })
                                                @*@Html.DropDownList("FrameworkWarrantyPeriod", (SelectList)ViewBag.WarrantyPeriodList, "Select Warranty", new { @class = "form-control selection" })*@
                                            </div>
                                            <div class="col-xl-1 col-lg-1 col-md-6 col-sm-12 col-12 m-t-5">
                                                <label class="control-label" for="Value"><b>Lettering</b></label>
                                                @*@Html.DropDownList("LetteringWarrantyPeriod", (SelectList)ViewBag.WarrantyPeriodList, "Select Warranty", new { @class = "form-control selection" })*@
                                                @Html.DropDownListFor(m => quoteItem.LetteringWarrantyPeriod, new SelectList(ViewBag.WarrantyPeriodList, "Id", "Duration", quoteItem.LetteringWarrantyPeriod), "Lettering Warranty ", new { @class = "form-control" })
                                            </div>
                                            <div class="col-xl-1 col-lg-1 col-md-6 col-sm-12 col-12 m-t-5">
                                                <label class="control-label" for="Value"><b>Illumination</b></label>
                                                @*@Html.DropDownList("IlluminationWarrantyPeriod", (SelectList)ViewBag.WarrantyPeriodList, "Select Warranty", new { @class = "form-control selection" })*@

                                                @Html.DropDownListFor(m => quoteItem.IlluminationWarrantyPeriod, new SelectList(ViewBag.WarrantyPeriodList, "Id", "Duration", quoteItem.IlluminationWarrantyPeriod), "Illumination Warranty ", new { @class = "form-control" })
                                            </div>
                                            <div class="col-xl-11 col-lg-11 col-md-11 col-sm-12 col-12 m-t-5">
                                                <label class="control-label" for="Description"><b>Description</b></label>


                                                <textarea class="form-control" id="Description">@quoteItem.Description</textarea>
                                                <!--<input type="text" placeholder="Description" class="form-control" id="Description" value="quoteItem.Description" />-->
                                            </div>
                                            <div class="col-xl-11 col-lg-11 col-md-11 col-sm-12 col-12 m-t-5">
                                                <label class="control-label" for="SpecialInstructions"><b>Special Instructions</b></label>
                                                <input type="text" placeholder="Special Instructions" class="form-control" id="SpecialInstructions" value="@quoteItem.SpecialInstruction" />
                                            </div>
                                            <div class="col-xl-11 col-lg-11 col-md-11 col-sm-12 col-12 m-t-5">
                                                <label class="control-label" for="Installation"><b>Installation</b></label>
                                                <input type="text" placeholder="Installation" class="form-control" id="Installation" value="@quoteItem.Installation" />
                                            </div>
                                            <div class="col-xl-1 col-lg-1 col-md-1 m-t-5">
                                                <br />
                                                <input type='button' id='remove' value='- Remove' class="btn btn-primary btn-xs full-width" onclick="removeItem(this);" />
                                            </div>
                                        </div>




                                    }




                                }
                                else
                                {

                                    <div class="form-row item m-t-10 m-b-20">
                                        <input type="hidden" id="itemId" class="form-control" />
                                        <div class="col-xl-4 col-lg-4 col-md-4 col-sm-12 col-12 m-t-5" id="HiddenId">

                                            <label class="control-label" for="product"><b>Product</b></label>
                                            @Html.DropDownList("quoteItem_CategoryId", new SelectList(ViewBag.CategoryList, "Id", "Name"), "Product ", new { @class = "form-control" })
                                        </div>



                                        <div class="col-md-1 m-t-5">
                                            <label class="control-label" for="Size"><b>Size</b></label>
                                            <input type="text" id="Size" placeholder="Size" class="form-control" />
                                        </div>
                                        <div class="col-xl-1 col-lg-1 col-md-1 m-t-5">
                                            <label class="control-label" for="itmQty"><b>Qty</b></label>
                                            <input type="text" id="itmQty" placeholder="Qty." class="form-control " />
                                        </div>
                                        <div class="col-xl-1 col-lg-1 col-md-1 m-t-5">
                                            <label class="control-label" for="itmCost"><b>Cost</b></label>
                                            <input type="text" id="itmCost" placeholder="0.00" onblur="CalTotalCost()" class="form-control " />
                                        </div>
                                        <div class="col-xl-2 col-lg-1 col-md-1 m-t-5">
                                            <label class="control-label" for="itmTotalCost"><b>Total Cost</b></label>
                                            <input type="text" id="itmTotalCost" placeholder="Total Cost" class="form-control " readonly="readonly" />
                                        </div>
                                        <div class="col-xl-1 col-lg-1 col-md-1 m-t-5">
                                            <label class="control-label" for="VAT"><b>VAT</b></label>
                                            <input type="text" id="VAT" placeholder="VAT" readonly="readonly" onblur="setTotals()" class="form-control" />
                                        </div>
                                        <div class="col-xl-2 col-lg-13 col-md-1 m-t-5">
                                            <label class="control-label" for="TotalCostVAT"><b>Total Cost with VAT</b></label>
                                            <input type="text" id="TotalCostVAT" placeholder="Total Cost with VAT" class="form-control" readonly="readonly" />
                                        </div>
                                        <div class="col-xl-2 col-lg-2 col-md-2 col-sm-12 col-12 m-t-5">
                                            <label class="control-label" for="Value"><b>Visibility</b></label>
                                            @Html.DropDownList("quoteItem_VisibilityId", new SelectList(ViewBag.VisibilityList, "Id", "Name"), "Visibility", new { @class = "form-control selection" })
                                        </div>
                                        <div class="col-xl-2 col-lg-1 col-md-6 col-sm-12 col-12 m-t-5">
                                            <label class="control-label" for="Value"><b>Illumination</b></label>
                                            @Html.DropDownList("quoteItem_Illumination", new SelectList(ViewBag.IlluminationList, "Id", "Name"), "Illumination", new { @class = "form-control selection" })
                                        </div>




                                        <div class="col-xl-11 col-lg-11 col-md-11 col-sm-12 col-12 m-t-5">
                                            <label class="control-label" for="Description"><b>Description</b></label>
                                            <textarea style="white-space: pre-wrap;" class="form-control" id="Description" rows="10"></textarea>
                                            <!--<input type="text" placeholder="Description" class="form-control" id="Description" />-->
                                        </div>

                                        <div class="col-xl-11 col-lg-11 col-md-11 col-sm-12 col-12 m-t-5">
                                            <label class="control-label" for="SpecialInstructions"><b>Special Instructions</b></label>
                                            <input type="text" placeholder="Special Instructions" class="form-control" id="SpecialInstructions" />
                                        </div>
                                        <div class="col-xl-11 col-lg-11 col-md-11 col-sm-12 col-12 m-t-5">
                                            <label class="control-label" for="Installation"><b>Installation</b></label>
                                            <input type="text" placeholder="Installation" class="form-control" id="Installation" />
                                        </div>
                                        <br />

                                        <div class="col-xl-2 col-lg-1 col-md-6 col-sm-12 col-12 m-t-5">
                                            <label class="control-label" for="Value"><b>Framework Warranty</b></label>
                                            @* @Html.DropDownList("IlluminationWarrantyPeriod", new SelectList(ViewBag.WarrantyPeriodList, "Id", "Name", "Illumination", new { @class = "form-control selection" }))*@
                                            @Html.DropDownList("quoteItem_FrameworkWarrantyPeriod", new SelectList(ViewBag.WarrantyPeriodList, "Id", "Duration"), "Framework", new { @class = "form-control selection" })

                                        </div>
                                        <div class="col-xl-2 col-lg-1 col-md-6 col-sm-12 col-12 m-t-5">
                                            <label class="control-label" for="Value"><b>Lettering Warranty</b></label>
                                            @Html.DropDownList("quoteItem_LetteringWarrantyPeriod", new SelectList(ViewBag.WarrantyPeriodList, "Id", "Duration"), "Lettering", new { @class = "form-control selection" })

                                        </div>
                                        <div class="col-xl-2 col-lg-1 col-md-6 col-sm-12 col-12 m-t-5">
                                            <label class="control-label" for="Value"><b>Illumination Warranty</b></label>
                                            @Html.DropDownList("quoteItem_IlluminationWarrantyPeriod", new SelectList(ViewBag.WarrantyPeriodList, "Id", "Duration"), "Illumination", new { @class = "form-control selection" })
                                        </div>

                                        <div class="col-xl-1 col-lg-1 col-md-6 col-sm-12 col-12 m-t-5">
                                            <br />
                                            <input type='button' id='remove' value='- Remove' class="btn btn-primary btn-xs full-width" onclick="removeItem(this);" />
                                        </div>
                                    </div>


                                }
                            </div>
                            <div class="form-row">
                                <div class="col-xl-1 col-lg-1 col-md-6 col-sm-12 col-12 m-t-5">
                                    <input type='button' id='add' value='+ Add item' class="btn btn-primary btn-xs" />
                                </div>
                                <div class="col-xl-1 col-lg-1 col-md-3 col-sm-12 col-12 m-t-5">

                                    <a class="btn btn-primary btn-xs full-width" href="~/Category">New Product</a>
                                </div>
                            </div>


                            @*DEPARTMENT*@
                            <div class="col-xl-11 col-lg-11 col-md-11 col-sm-12 col-12 m-t-5">
                                <label class="control-label" for="Value"><b>Department</b></label>
                                <div class="col-xl-11 col-lg-11 col-md-11 col-sm-12 col-12 m-t-5">

                                    @Html.CheckBoxFor(m => m.IsPrintingDepartment)
                                    <label for="PrintingDepartment"> Printing Department</label><br>


                                    @Html.CheckBoxFor(m => m.IsCuttingDepartment)
                                    <label for="CuttingDepartment"> Cutting Department</label><br>

                                    @Html.CheckBoxFor(m => m.IsPlasticDepartment)
                                    <label for="PlasticDepartment"> Plastic Department</label><br>

                                    @Html.CheckBoxFor(m => m.IsCladdingsection)
                                    <label for="Claddingsection"> Cladding section</label><br>


                                    @Html.CheckBoxFor(m => m.IsArtDepartment)
                                    <label for="ArtDepartment"> Art  Department</label><br>


                                    @Html.CheckBoxFor(m => m.IsSteelDepartment)
                                    <label for="steelDepartment"> Steel Department</label><br>

                                    @Html.CheckBoxFor(m => m.IsScreenPrintingDept)
                                    <label for="ScreenPrintingDept"> Screen Printing Dept</label><br>

                                    @Html.CheckBoxFor(m => m.IsProductionDepartment)
                                    <label for="ProductionDepartment"> Production Department</label><br>

                                    @Html.CheckBoxFor(m => m.IsPackingDepartment)
                                    <label for="PackingDepartment"> Packing Department</label><br>

                                    @Html.CheckBoxFor(m => m.IsInstallationTeam)
                                    <label for="InstallationTeam"> Installation Team</label><br>
                                </div>

                            </div>


                        </div>

                        @*---------------THIRDTAB---------------*@
                        <div class="tab-pane fade" id="_ThirdTab">


                            <div class="" id="summerydiv">
                                <table class="table table-bordered" id="summerytble">
                                    <thead>
                                        <tr>
                                            <th style="font-size: medium; color:black ">Item</th>
                                            <th style="font-size: medium; color:black ">Quantity</th>
                                            <th style="font-size: medium; color:black ">Cost</th>
                                            <th style="font-size: medium; color:black ">Total Cost</th>

                                        </tr>
                                    </thead>
                                    <tbody id="sumtdata" style="font:bolder; color:black ">
                                    </tbody>
                                </table>
                            </div>


                            @if (Model.AdditionalCharges.Count > 0)
                            {
                                foreach (var adcharge in Model.AdditionalCharges)
                                {<div class="form-row addcharge">
                                        <div class="col-xl-2 col-lg-1 col-md-1 m-t-5" id="withHidden">
                                            <input type="hidden" id="AddchrgId" class="form-control" value="@adcharge.Id" />
                                            <label class="control-label" for="adchrItem"><b>Additional charge</b></label>
                                            <input type="text" id="adchrItem" placeholder="Additional charge" value="@adcharge.AddCharge" class="form-control " />
                                        </div>

                                        <div class="col-xl-1 col-lg-1 col-md-1 m-t-5">
                                            <label class="control-label" for="adchrQty"><b>Qty</b></label>
                                            <input type="text" id="adchrQty" placeholder="Qty." value="@adcharge.Qty" class="form-control text-right" />
                                        </div>
                                        <div class="col-xl-1 col-lg-1 col-md-1 m-t-5" id="a">
                                            <label class="control-label" for="adchrCost"><b>Cost</b></label>
                                            <input type="text" id="adchrCost" placeholder="Cost" value="@adcharge.Cost.ToString("#,###,##0.00")" class="form-control" />
                                        </div>
                                        <div class="col-xl-2 col-lg-1 col-md-1 m-t-5">
                                            <label class="control-label" for="adchrTotalCost"><b>Total Cost</b></label>
                                            <input type="text" id="adchrTotalCost" placeholder="Total Cost" value="@adcharge.TotalCost.ToString("#,###,##0.00")" class="form-control text-right" readonly="readonly" />
                                        </div>
                                        <div class="col-xl-1 col-lg-1 col-md-1 m-t-5">
                                            <label class="control-label" for="">&nbsp;</label><br />
                                            <input type='button' id='removechrg' value='- Remove' class="btn btn-primary btn-xs full-width" onclick="removeCharge(this);" />
                                        </div>

                                    </div>
                                }
                            }
                            else
                            {
                                <div class="form-row addcharge">
                                    <div class="col-xl-2 col-lg-1 col-md-1 m-t-5" id="withHidden">
                                        <input type="hidden" id="AddchrgId" class="form-control" />
                                        <label class="control-label" for="adchrItem"><b>Additional charge</b></label>
                                        <input type="text" id="adchrItem" placeholder="Additional charge" class="form-control " />
                                    </div>

                                    <div class="col-xl-1 col-lg-1 col-md-1 m-t-5">
                                        <label class="control-label" for="adchrQty"><b>Qty</b></label>
                                        <input type="text" id="adchrQty" placeholder="Qty." onblur="CalAddTotalCost()" class="form-control text-right" />
                                    </div>
                                    <div class="col-xl-1 col-lg-1 col-md-1 m-t-5" id="a">
                                        <label class="control-label" for="adchrCost"><b>Cost</b></label>
                                        <input type="text" id="adchrCost" placeholder="Cost" onblur="CalAddTotalCost()" class="form-control" />
                                    </div>
                                    <div class="col-xl-2 col-lg-1 col-md-1 m-t-5">
                                        <label class="control-label" for="adchrTotalCost"><b>Total Cost</b></label>
                                        <input type="text" id="adchrTotalCost" placeholder="Total Cost" class="form-control text-right" readonly="readonly" />
                                    </div>
                                    <div class="col-xl-1 col-lg-1 col-md-1 m-t-5">
                                        <label class="control-label" for="">&nbsp;</label><br />
                                        <input type='button' id='removechrg' value='- Remove' class="btn btn-primary btn-xs full-width" onclick="removeCharge(this);" />
                                    </div>
                                </div>
                            }

                            <div class="form-row">
                                <div class="col-xl-2 col-lg-1 col-md-1 m-t-2" id="withHidden">

                                </div>

                                <div class="col-xl-1 col-lg-1 col-md-1 m-t-2">

                                </div>
                                <div class="col-xl-1 col-lg-1 col-md-1 m-t-2" id="a">

                                </div>
                                <div class="col-xl-2 col-lg-1 col-md-1 m-t-2">

                                </div>
                                <div class="col-xl-1 col-lg-1 col-md-1 m-t-2">
                                    <label class="control-label" for="AddChr">&nbsp;</label>
                                    <input id="AddChr" type="button" value="+ Add Charge" class="btn btn-primary btn-xs full-width" />
                                </div>
                            </div>


                            <div class="form-row">
                                <div class="col-xl-2 col-lg-2 col-md-12 col-sm-12 col-12 m-t-5">
                                    <input type="hidden" id="AddchrgId" class="form-control" />
                                    <label class="control-label" for="OrderTotal"><b>Order Total</b></label>
                                    <input type="text" id="OrderTotal" placeholder="OrderTotal" class="form-control " onclick="CalVatTotal(); CalAddTotalCost()" readonly="readonly" />
                                </div>
                                <div class="col-xl-2 col-lg-1 col-md-1 m-t-5">
                                    <label class="control-label" for="OrderVAT"><b>VAT</b></label>
                                    <input type="text" id="OrderVAT" placeholder="0.00" class="form-control " onclick="CalVatTotal()" />
                                    @*@Html.TextBoxFor(m => m.OrderVAT, new { @class = "form-control" })*@
                                </div>
                                <div class="col-xl-2 col-lg-13 col-md-1 m-t-5">
                                    <label class="control-label" for="ordTotalCostVAT"><b>Total Cost with VAT</b></label>
                                    <input type="text" id="ordTotalCostVAT" placeholder="Total Cost with VAT" class="form-control" onclick="CalVatTotal()" readonly="readonly" />
                                </div>


                            </div>
                            <div class="form-row">
                                <div class="col-xl-2 col-lg-1 col-md-1 m-t-5">
                                    <label class="control-label" for="AdvancePayment"><b>Advance Payment</b></label>
                                    @Html.TextBoxFor(m => m.AdvancePayment, new { @class = "form-control" })
                                </div>


                                <div class="col-xl-2 col-lg-1 col-md-1 m-t-5">
                                    <label class="control-label" for="BalancePayment"><b>Balance Payment</b></label>
                                    <input type="text" id="BalancePayment" placeholder="Balance Payment" class="form-control " readonly="readonly" />
                                </div>

                            </div>
                            <div class="form-row">
                                <div class="col-xl-10 col-lg-1 col-md-1 m-t-5">
                                    <label class="control-label" for="PaymentDetails"><b>Payment Details</b></label>
                                    <input type="text" id="PaymentDetails" placeholder="Payment Details." class="form-control " />
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="col-xl-10 col-lg-2 col-md-12 col-sm-12 col-12 m-t-5">
                                    <label class="control-label" for="Remarks"><b>Remarks</b></label>
                                    @Html.TextBoxFor(m => m.Remarks, new { @class = "form-control" })
                                </div>

                            </div>
                            <hr />






                        </div>




                        @*---------------FourthTAB----------------------*@
                        <div id="_FourthTab" class="tab-pane fade">


                            @if (Model.OrderAttachments.Count > 0)

                            {
                                <div class="form-row">

                                    <div style="padding-left:2%;" class="m-t-5">
                                        <h5>Attachments</h5>
                                        <input type="file" multiple id="FilesUp" name="filename" formenctype="multipart/form-data">
                                        <input type="button" id="btnFileuP" value="Add File" class="btn btn-primary" />
                                    </div>

                                </div>
                                foreach (var attachment in Model.OrderAttachments)
                                {
                                    <div id="attachmentParent">
                                        <div class="form-row attachement" id="divattachment-@attachment.Id">
                                            <div class="col-xl-2 col-lg-1 col-md-1 m-t-5" id="attachmentChild">

                                                <br>
                                                <input type="text" id="actfilename" class="form-control " value="@attachment.ActualName" disabled="disabled" />
                                                <input type="hidden" id="savefilename" value="@attachment.ActualName" class="form-control text-right" />

                                            </div>
                                            <div class="col-xl-2 col-lg-1 col-md-1 m-t-5 d-flex align-items-end">
                                                <button type="button" class="btn btn-danger btn-sm DelF" value="@attachment.Id" id="DelF">Delete</button>
                                                <!-- <input type="button" id="DelF" value="@attachment.Id" class="btn btn-danger btn-sm DelF"/>              -->
                                            </div>

                                        </div>

                                    </div>
                                }
                            }
                            else
                            { <div class="form-row">

                                    <div style="padding-left:2%;" class="m-t-5">
                                        <h5>Attachments</h5>
                                        <input type="file" multiple id="FilesUp" name="filename" formenctype="multipart/form-data" />
                                        <input type="button" id="btnFileuP" value="Add File" class="btn btn-primary" />
                                    </div>

                                </div>
                                <div id="attachmentParent">
                                    <div class="form-row attachement invisible" id="divattachment">
                                        <div class="col-xl-2 col-lg-1 col-md-1 m-t-5" id="attachmentChild">
                                            <br>
                                            <input type="text" id="actfilename" class="form-control " disabled="disabled" />
                                            <input type="hidden" id="savefilename" class="form-control text-right" />
                                        </div>
                                    </div>

                                </div>

                                <hr />
                            }
                            @if (!(Model.OrderAttachments.Count > 0))
                            {


                                <div class="form-row">
                                    <div id="outer" class="col-xl-2 col-lg-1 col-md-1 m-t-5">
                                        <div class="inner"><input type="submit" id="btnSave" class="btn btn-primary" value="Save" /></div>
                                    </div>
                                    @if (Model.Id > 0 && User.IsInRole("Administrator"))
                                    {

                                        <div id="outer" class="col-xl-2 col-lg-1 col-md-1 m-t-5">

                                            <div class="inner">
                                                <button type="button" class="btn btn-danger btn-sm cancelOrd" value="@Model.Id" id="cancelOrd">Cancel Order</button>
                                            </div>
                                        </div>

                                    }
                                    <div id="cmdprint" class="col-xl-2 col-lg-1 col-md-1 m-t-5">
                                        <div class="inner"><input type="button" class="btn btn-primary" value="Print" onclick="PrintOrder(@Model.Id)" /></div>
                                    </div>
                                    <div id="cmdaprove" class="col-xl-2 col-lg-1 col-md-1 m-t-5">
                                        @* <div class="inner"><input type="button" class="btn btn-primary" value="Approve" /></div>*@
                                    </div>

                                </div>
                            }
                        </div>




                        @if (Model.Id > 0 && (User.IsInRole("Administrator") || User.IsInRole("Factory")))
                        {

                            @*---------------Fifth-----------------------------*@
                            <div id="_FifthTab" class="tab-pane fade @(IsFactory)">
                                @if (Model.OrderMaterials.Count > 0)

                                {
                                    foreach (var ordermat in Model.OrderMaterials)
                                    {


                                        <div class="form-row materials">
                                            <div class="col-xl-5  col-lg-5 col-md-5 col-sm-12 col-12 m-t-5" id="withHidden">
                                                <input type="hidden" id="ordmatrId" class="form-control" value="@ordermat.Id" />
                                                <label class="control-label" for="OrderMaterial"><b>Material</b></label>
                                                @*@Html.DropDownList("OrderMaterial", new SelectList(ViewBag.MaterialList, "Id", "Name"), "Materials", new { @class = "form-control selection" })*@
                                                @Html.DropDownListFor(m => ordermat.MaterialId, new SelectList(ViewBag.MaterialList, "Id", "Name", ordermat.MaterialId.Value), "Materials", new { @class = "form-control selection" })

                                            </div>

                                            <div class="col-xl-5 col-lg-5 col-md-5 col-sm-12 col-12 m-t-5">
                                                <label class="control-label" for="OrderMaterialSupplier"><b>Supplier</b></label>
                                                @*@Html.DropDownList("OrderMaterialSupplier", new SelectList(ViewBag.SupplierList, "Id", "Name"), "Suppliers", new { @class = "form-control selection" })*@
                                                @Html.DropDownListFor(m => ordermat.SupplierId, new SelectList(ViewBag.SupplierList, "Id", "Name", ordermat.SupplierId.Value), "Suppliers", new { @class = "form-control selection" })
                                            </div>

                                            <div class="col-xl-5 col-lg-5 col-md-5 col-sm-12 col-12 m-t-5">

                                                <label class="control-label" for="ordermat_AttributeId"><b>Attributes</b></label>
                                                <input type="text" id="ordermat_AttributeId" placeholder="Attribute." value="@ordermat.Attribute" class="form-control text-left" />
                                                @*Html.DropDownListFor(m => ordermat.AttributeId, new SelectList(ViewBag.AttributeList, "Id", "Attribute1", ordermat.AttributeId.Value), "Attribute", new { @class = "form-control selection" })*@
                                                @*@Html.DropDownList("OrderMaterialAttribute", new SelectList(ViewBag.AttributeList, "Id", "Attribute1"), "Attribute", new { @class = "form-control selection" })*@
                                            </div>
                                            <div class="col-xl-5 col-lg-5 col-md-5 col-sm-12 col-12 m-t-5">
                                                <label class="control-label" for="ordmatVal"><b>Value</b></label>
                                                <input type="text" id="ordmatVal" placeholder="Value." value="@ordermat.Value" class="form-control text-left" />
                                                @*<input type="text" id="ordmatVal" placeholder="Value" class="form-control text-right" />*@
                                            </div>
                                        </div>
                                    }
                                    <div class="col-xl-1 col-lg-1 col-md-1 m-t-5">
                                        <label class="control-label" for="AddMat">&nbsp;</label><br />
                                        <input type='button' id='AddMat' value='+ Add' class="btn btn-primary btn-xs full-width" />
                                    </div>

                                }
                                else
                                {
                                    <div class="form-row materials">

                                        <div class="col-xl-4 col-lg-4 col-md-4 col-sm-12 col-12 m-t-5" id="withHidden">
                                            <input type="hidden" id="ordmatrId" class="form-control" />
                                            <label class="control-label" for="ordermat_MaterialId"><b>Material</b></label>
                                            @Html.DropDownList("ordermat_MaterialId", new SelectList(ViewBag.MaterialList, "Id", "Name"), "Materials", new { @class = "form-control selection" })

                                        </div>

                                        <div class="col-xl-4 col-lg-4 col-md-4 col-sm-12 col-12 m-t-5">
                                            <label class="control-label" for="ordermat_SupplierId"><b>Supplier</b></label>
                                            @Html.DropDownList("ordermat_SupplierId", new SelectList(ViewBag.SupplierList, "Id", "Name"), "Suppliers", new { @class = "form-control selection" })
                                        </div>


                                        <div class="col-xl-4 col-lg-4 col-md-4 col-sm-12 col-12 m-t-5">

                                            <label class="control-label" for="ordermat_AttributeId"><b>Attributes</b></label>
                                            <input type="text" id="ordermat_AttributeId" placeholder="Attribute" class="form-control text-left" />
                                        </div>
                                        <div class="col-xl-4 col-lg-4 col-md-4 col-sm-12 col-12 m-t-5">
                                            <label class="control-label" for="ordmatVal"><b>Value</b></label>
                                            <input type="text" id="ordmatVal" placeholder="Value" class="form-control text-left" />
                                        </div>

                                    </div>
                                    <div class="col-xl-1 col-lg-1 col-md-1 m-t-5">
                                        <label class="control-label" for="AddMat">&nbsp;</label><br />
                                        <input type='button' id='AddMat' value='+ Add' class="btn btn-primary btn-xs full-width" />
                                    </div>

                                }
                            </div>
                            @*----------------------SIXTH TAB ----------------------------*@

                            <div id="_SixthTab" class="tab-pane fade">
                                <div class="LastTab">
                                    <div class="form-row Dates">
                                        <div class="col-xl-2 col-lg-2 col-md-12 col-sm-12 col-12 m-t-5">

                                            <label class="control-label" for="JobCompletionDate">Job Completion Date</label>

                                            @Html.TextBoxFor(m => m.CompletionDate, new { @class = "datepicker" })

                                        </div>
                                        <div class="col-xl-2 col-lg-2 col-md-12 col-sm-12 col-12 m-t-5">

                                            <label class="control-label" for="InstallationDate">Installation Date</label>

                                            @Html.TextBoxFor(m => m.InstallationDate, new { @class = "datepicker" })

                                        </div>


                                    </div>
                                    <div class="form-row InstallationDetails">

                                        <div class="col-xl-11 col-lg-11 col-md-11 col-sm-12 col-12 m-t-5">
                                            <label class="control-label" for="Installation"><b>Installation Team</b></label>
                                            @* <input type="text" placeholder="Installation Team" class="form-control" id="InstallationTeam" />*@
                                            @Html.TextBoxFor(m => m.InstallationTeam, new { @class = "form-control" })
                                        </div>
                                        <div class="col-xl-11 col-lg-11 col-md-11 col-sm-12 col-12 m-t-5">
                                            <label class="control-label" for="InstallationVehicleType"><b>Installation Vehicle Type</b></label>
                                            @* <input type="text" placeholder="Installation Vehicle Type" class="form-control" id="InstallationVehicleType" />*@
                                            @Html.TextBoxFor(m => m.InstallationVehicleType, new { @class = "form-control" })
                                        </div>
                                        <div class="col-xl-11 col-lg-11 col-md-11 col-sm-12 col-12 m-t-5">
                                            <label class="control-label" for="Contact Person">Location</label>
                                            @Html.TextBoxFor(m => m.InstallationLocation, new { @class = "form-control" })
                                        </div>
                                        <div class="col-xl-11 col-lg-11 col-md-11 col-sm-12 col-12 m-t-5">
                                            <label class="control-label" for="InstallationRemarks"><b>Installation Remarks</b></label>
                                            @Html.TextBoxFor(m => m.InstallationRemark, new { @class = "form-control" })
                                        </div>
                                        <div class="col-xl-2 col-lg-2 col-md-6 col-sm-12 col-12 mb-2 m-t-5">

                                            @if (User.IsInRole("Factory"))
                                            {
                                                <label class="control-label" for="ChanneledBy">Order Status</label>
                                                @Html.DropDownList("StatusId", (SelectList)ViewBag.Status, "Select Status", new { @class = "form-control selection" })
                                            }

                                            @* @Html.DropDownList("quoteItem_LetteringWarrantyPeriod", new SelectList(ViewBag.WarrantyPeriodList, "Id", "Duration"), "Lettering", new { @class = "form-control selection" })*@

                                        </div>
                                    </div>
                                    <br />
                                    @*Material Attachments*@

                                    @if (Model.InstallationAttachments.Count > 0)

                                    {
                                        <div class="form-row material-attachment">

                                            <div style="padding-left:2%;" class="m-t-5">
                                                <h5>Attachments</h5>
                                                <input type="file" multiple id="InstaltFilesUp" name="filename" formenctype="multipart/form-data" />
                                                <input type="button" id="btnFileuP2" value="Add File" class="btn btn-primary" />
                                            </div>

                                        </div>
                                        foreach (var attachment in Model.InstallationAttachments)
                                        {
                                            <div id="installationAttachmentParent">
                                                <div class="form-row attachement" id="installationdivattachment-@attachment.Id">
                                                    <div class="col-xl-2 col-lg-1 col-md-1 m-t-5" id="InstalAttachmentChild">
                                                        <br>
                                                        <input type="text" id="InstalActfilename" value="@attachment.ActualName" class="form-control " disabled="disabled" />
                                                        <input type="hidden" id="InstalSavefilename" value="@attachment.ActualName" class="form-control text-right" />
                                                    </div>
                                                    <div class="col-xl-2 col-lg-1 col-md-1 m-t-5 d-flex align-items-end">
                                                        <button type="button" class="btn btn-danger btn-sm DelInstF" value="@attachment.Id" id="DelInstF">Delete</button>
                                                        <!-- <input type="button" id="DelF" value="@attachment.Id" class="btn btn-danger btn-sm DelF"/>              -->
                                                    </div>
                                                </div>

                                            </div>
                                        }
                                    }
                                    else
                                    {
                                        <div class="form-row material-attachment">

                                            <div style="padding-left:2%;" class="m-t-5">
                                                <h5>Attachments</h5>
                                                <input type="file" multiple id="InstaltFilesUp" name="filename" formenctype="multipart/form-data" />
                                                <input type="button" id="btnFileuP2" value="Add File" class="btn btn-primary" />
                                            </div>

                                        </div>
                                        <div id="installationAttachmentParent">
                                            <div class="form-row attachement invisible" id="installationdivattachment">
                                                <div class="col-xl-2 col-lg-1 col-md-1 m-t-5" id="InstalAttachmentChild">
                                                    <br>
                                                    <input type="text" id="InstalActfilename" class="form-control " disabled="disabled" />
                                                    <input type="hidden" id="InstalSavefilename" class="form-control text-right" />
                                                </div>
                                            </div>
                                        </div>
                                    }


                                    <hr />
                                    @if (Model.Id > 0)
                                    {


                                        <div class="form-row">
                                            <div id="outer" class="col-xl-2 col-lg-1 col-md-1 m-t-5">
                                                <div class="inner"><input type="submit" id="btnSave" class="btn btn-primary" value="Save" /></div>
                                            </div>
                                            @if (User.IsInRole("Administrator"))
                                            {
                                                <div id="outer" class="col-xl-2 col-lg-1 col-md-1 m-t-5">

                                                    <div class="inner">
                                                        <button type="button" class="btn btn-danger btn-sm cancelOrd" value="@Model.Id" id="cancelOrd">Cancel Order</button>
                                                    </div>
                                                </div>
                                            }
                                            <div id="cmdprint" class="col-xl-2 col-lg-1 col-md-1 m-t-5">
                                                <div class="inner"><input type="button" class="btn btn-primary" value="Print" onclick="PrintOrder(@Model.Id)" /></div>
                                            </div>
                                            <div id="cmdaprove" class="col-xl-2 col-lg-1 col-md-1 m-t-5">
                                                @* <div class="inner"><input type="button" class="btn btn-primary" value="Approve" /></div>*@
                                            </div>

                                        </div>
                                    }
                                </div>
                            </div>
                        }

                    </div>
                }
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">New Client</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                @Html.Partial("_NewClientPartial", new Client())
            </div>
            @*<div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>*@
        </div>
    </div>
</div>

<div class="modal fade" id="reportModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                @* <h5 class="modal-title" id="exampleModalLabel">Medical Report</h5>*@
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body" id="Preview">
                @*@Html.Partial("_PrintOrder")*@
            </div>
            <div class="modal-footer">

                <button id="btnPrint" type="button" class="btn btn-primary">Print</button>
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<!--<div class="modal fade" id="productModal" tabindex="-1" role="dialog" aria-labelledby="productModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="productModalLabel">New Client</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>f
            <div class="modal-body">

            </div>-->
@*<div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
    </div>*@
<!--</div>
    </div>
</div>-->
<link href="~/Content/themes/base/datepicker.css" rel="stylesheet" />
<script>



    function PrintOrder(id) {
        $.ajax({
            type: "GET",
            url: '@Url.Action("PrintOrder", "Order")',
            data: { id: id },
            success: function (data) {
                $('#Preview').html(data);
                $('#reportModal').modal('show');
            }
        })
    }


    //var MaterialArrId = []
    //var SupplierArrId = [];
    //var AttributeArrId = [];
    //var ValueArrId = [];




    $(document).ready(function () {



        $('.DelInstF').click(function (e) {
            var Attid = e.target.value
            var fileDiv = "#installationdivattachment-" + Attid;

            var parentDiv = document.querySelectorAll('#InstalAttachmentChild');


            var elem = document.querySelector(fileDiv);
            $(elem).remove();
            var h = parentDiv.length;
            if (h <= 1) {
                var htmlToAppend = `
      <div class="form-row attachement" id="installationdivattachment">
    <div class="col-xl-2 col-lg-1 col-md-1 m-t-5" id="InstalAttachmentChild">
        <br>
        <input type="text" id="InstalActfilename" class="form-control " disabled="disabled" />
        <input type="hidden" id="InstalSavefilename" class="form-control text-right" />
    </div>
</div>
    `;
                $('#installationAttachmentParent').append(htmlToAppend);
            }

            $.ajax({
                url: '/Order/DeleteInstallationAttachment',
                dataType: "text json",
                type: "POST",
                data: { id: Attid },
                success: function (result) {
                    alert(result);
                },
                error: function (err) {
                    alert(err.statusText);
                }
            });
            e.preventDefault();
        });


        $('.cancelOrd').click(function (e) {
            var Attid = e.target.value
            $.ajax({
                url: '/Order/CancelOrder',
                type: "POST",
                data: { id: Attid },
                success: function (result) {
                    window.location.href = '/Order'
                },
                error: function (err) {
                    alert(err.statusText);
                }
            });
            e.preventDefault();
        });



        $('.DelF').click(function (e) {
            var Attid = e.target.value
            var fileDiv = "#divattachment-" + Attid;

            var parentDiv = document.querySelectorAll('#attachmentChild');


                var elem = document.querySelector(fileDiv);
            $(elem).remove();
            var h = parentDiv.length;
            if(h<=1) {
                var htmlToAppend = `
      <div class="form-row attachment" id="divattachment">
        <div class="col-xl-2 col-lg-1 col-md-1 m-t-5" id="attachmentChild">
          <br>
          <input type="text" id="actfilename" class="form-control" disabled="disabled" />
          <input type="hidden" id="savefilename" class="form-control text-right" />
        </div>
      </div>
    `;
                $('#attachmentParent').append(htmlToAppend);
            }

            $.ajax({
                url:'/Order/DeleteOrderAttachment',
                dataType: "text json",
                type: "POST",
                data: {id:Attid},
                success: function (result) {
                    alert(result);
                },
                error: function (err) {
                    alert(err.statusText);
                }
            });
            e.preventDefault();
        });


        var selectedval = $('#OrderTypeId').val();
        if (selectedval != "1") {
            //(selectedval == "2") || (selectedval == "3") || (selectedval == "4")
            $("#VATNo").attr("disabled", "disabled");
            $("#VAT").attr("disabled", "disabled");
            $("#OrderVAT").attr("disabled", "disabled");

            $("#TotalCostVAT").attr("disabled", "disabled");
            $("#ordTotalCostVAT").attr("disabled", "disabled");
        }

        else {
            $("#VATNo").removeAttr('disabled');
            $("#VAT").removeAttr('disabled');
            $("#OrderVAT").removeAttr('disabled');
            $("#TotalCostVAT").removeAttr('disabled');
            $("#ordTotalCostVAT").removeAttr('disabled');
        }
        $("input[data-type='currency']").on({
            keyup: function () {
                formatCurrency($(this));
            },
            blur: function () {
                formatCurrency($(this), "blur");
            }
        });

        // Material File upload
        $('#btnFileuP2').click(function () {


            var fileUpload = $("#InstaltFilesUp").get(0);
            var files = fileUpload.files;


            // Create  a FormData object
            var fileData = new FormData();
            var upfilename;

            // if there are multiple files , loop through each files
            for (var i = 0; i < files.length; i++) {
                fileData.append(files[i].name, files[i]);
                upfilename = files[i].name;
              /*  $('#actfilename').val(files[i].name.toString());*/
                $('#Matattachment-count').val(parseInt($('#Matattachment-count').val()) + 1);
            }

            // Adding more keys/values here if need
          //  fileData.append('Test', "Test Object values");

            $.ajax({
                url: '/Order/UploadFiles', //URL to upload files
                type: "POST", //as we will be posting files and other method POST is used
                processData: false, //remember to set processData and ContentType to false, otherwise you may get an error
                contentType: false,
                data:fileData,
                success: function (result) {
                    alert(result);
                },
                error: function (err) {
                    alert(err.statusText);
                }
            });
           /* var n = $('.attachement');*/

            var n = $('#Matattachment-count').val();
            var elem2 = document.querySelectorAll('#InstalAttachmentChild');
            var h = elem2.length;
            if (h > 0)
                n = parseInt(h) +parseInt(n);
            if (n > 1) {


                var elem = document.querySelector('#installationdivattachment');
                var clone = elem.cloneNode(true);
                clone.id = "installationdivattachment" + n;
                clone.className ="form-row attachement"
                elem.parentElement.insertBefore(clone, elem.parentElement.children[elem.parentElement.length - 1]);
                var label = clone.querySelector("input");
                label.value = files[0].name;




            } else {
                $('#InstalActfilename').val(files[0].name.toString());
            }





        });



        //Order Attachement File upload
        $('#btnFileuP').click(function () {


            var fileUpload = $("#FilesUp").get(0);
            var files = fileUpload.files;


            // Create  a FormData object
            var fileData = new FormData();
            var upfilename;

            // if there are multiple files , loop through each files
            for (var i = 0; i < files.length; i++) {
                fileData.append(files[i].name, files[i]);
                upfilename = files[i].name;
                /*  $('#actfilename').val(files[i].name.toString());*/
                $('#attachment-count').val(parseInt($('#attachment-count').val()) + 1);
            }

            // Adding more keys/values here if need
            //  fileData.append('Test', "Test Object values");

            $.ajax({
                url: '/Order/FileUpload', //URL to upload files
                type: "POST", //as we will be posting files and other method POST is used
                processData: false, //remember to set processData and ContentType to false, otherwise you may get an error
                contentType: false,
                data: fileData,
                success: function (result) {
                    alert(result);
                },
                error: function (err) {
                    alert(err.statusText);
                }
            });
            /* var n = $('.attachement');*/

            var n = $('#attachment-count').val();
            var elem2 = document.querySelectorAll('#attachmentChild');
            var h = elem2.length;
            if (h > 0)
                n = parseInt(h) + parseInt(n);
            if (n > 1) {


                var elem = document.querySelector('#divattachment');
                var clone = elem.cloneNode(true);
                clone.id = "divattachment" + n;
                clone.className ="form-row attachement"
                elem.parentElement.insertBefore(clone, elem.parentElement.children[elem.parentElement.length - 1]);
                var label = clone.querySelector("input");
                label.value = files[0].name;




            } else {
                $('actfilename').val(files[0].name.toString());
            }





        });

        //materials table=======================================================================================================

        //var MaterialArr = []
        //var SupplierArr = [];
        //var AttributeArr = [];
        //var ValueArr = [];
        //var count = 0;
        //$("#AddMat").click(function() {

        //    MaterialArr.push($(".material").find('select#OrderMaterial option:selected').text());
        //    SupplierArr.push($(".material").find('select#OrderMaterialSupplier option:selected').text());
        //    AttributeArr.push($(".attribuites").find('select#OrderMaterialAttribute option:selected').text());
        //    ValueArr.push($(".attribuites").find('input#ordmatVal').val());


        //    MaterialArrId.push($(".material").find('select#OrderMaterial option:selected').val());
        //    SupplierArrId.push($(".material").find('select#OrderMaterialSupplier option:selected').val());
        //    AttributeArrId.push($(".attribuites").find('select#OrderMaterialAttribute option:selected').val());
        //    ValueArrId.push($(".attribuites").find('input#ordmatVal').val());
        //    count++;

        //    $('#matTableData').append("<tr class='materialrow'>" +
        //        "<td>" + MaterialArr[count-1] + "</td>" +
        //        "<td>" + SupplierArr[count-1] + "</td>" +
        //        "<td>" + AttributeArr[count-1] + "</td>" +
        //        "<td>" + ValueArr[count-1] + "</td>" + "<tr>"
        //    );
        //})

        //====================================================================================================================
        $(".order-type").change(function () {
            var selectedval = $(this).val()
            if (selectedval != "1")  {
                $("#VATNo").attr("disabled", "disabled");
                $("#VAT").attr("disabled", "disabled");
                $("#OrderVAT").attr("disabled", "disabled");

                $("#TotalCostVAT").attr("disabled", "disabled");
                $("#ordTotalCostVAT").attr("disabled", "disabled");
            }

            else {
                $("#VATNo").removeAttr('disabled');
                $("#VAT").removeAttr('disabled');
                $("#OrderVAT").removeAttr('disabled');
                $("#TotalCostVAT").removeAttr('disabled');
                $("#ordTotalCostVAT").removeAttr('disabled');
            }

        });
    });
    function removeItem(elem) {
        if ($('#item-count').val() != "1") {
            $('#item-count').val(parseInt($('#item-count').val()) - 1);
            $(elem).parent().parent('div').remove();
        }
        else {
            alert('Last item cannot be removed');
        }
    }

    function removeCharge(elem) {

        if ($('#charge-count').val() != "1") {
            $('#charge-count').val(parseInt($('#charge-count').val()) - 1);
            $(elem).parent().parent('div').remove();
        }
        else {
            alert('Last item cannot be removed');
        }
    }



    function CalTotalCost(elem) {

        elem = $(this);
        setTotals(elem);

    }
    function CalAddTotalCost(elem) {

        elem = $(this);
        setAddTotals(elem);

    }
    function CalVatTotal(elem) {
        elem = $(this);
       /* setVatTotals(elem);*/
    }


    function OrderTotal(total) {

        elem = $(this);
        var itmtot = 0;
        var vatTot = 0;


        itmtot = parseFloat(total);
        for (var x = 0; x < vatAmountArray.length; x++) {
             vatTot += parseFloat(vatAmountArray[i])
        }

        var chargeordTotalCostArray = [];
        var chrg_list = document.querySelectorAll('[class*="form-row addcharge"]');
        $.each(chrg_list, function (key, obj) {
            chargeordTotalCostArray.push($(obj).find('input#adchrTotalCost').val().replaceAll(",", "").replace(".00", ""));

        });
        if (chargeordTotalCostArray.length > 0 && chargeordTotalCostArray[0] != "") {
            for (var i = 0; i < chargeordTotalCostArray.length; i++) {
                itmtot += parseFloat(chargeordTotalCostArray[i].replaceAll(",", "").replace(".00", ""));
            }
        }
        else {
            itmtot = parseFloat(total);
        }


        return itmtot.toFixed(2);

    }



    $(document).ready(function () {



        $("#btnSave").click(function () {

            var clientidSelect = $("#ClientId option:selected").val();
            var typeSelect = $("#OrderTypeId option:selected").val();
            var ProductSelect = $("#quoteItem_CategoryId option:selected").val();
            var DeliverySelect = $("#DeliveryTypeId option:selected").val();
            var ChanneledBySelect = $("#ChanneledById option:selected").val();
            var SizeSelect = $("#Size").val();
            var DescriptionSelect = $("#Description").val();
            var itmQTYSelect = $("#itmQty").val();
            var itmCostSelect = $("#itmCost").val().replace(",","");


            if (typeSelect == "") {
                alert("select Order Type");
                return false;
            }
            if (ChanneledBySelect == "") {
                alert("select Channeled By");
                return false;

            }
            if (clientidSelect == "") {
                alert("select client");
                return false;
            }
            if (DeliverySelect == "") {
                alert("select Delivery");
                return false;
            }
            if (SizeSelect == "") {
                alert("Enter Size");
                return false;
            }
            if (DescriptionSelect == "") {
                alert("Enter Description");
                return false;
            }

            if (itmQTYSelect == "") {
                alert("Enter Quantity");
                return false;
            }
            if (itmCostSelect == "") {
                alert("Enter Cost");
                return false;
            }
            if (ProductSelect == "" ) {
                alert("select Product");
                return false;
            }




        });


    $("#tabstrip").tabs({
        active: 1,
        activate: function (event, ui) {
            var active = $('#tabstrip').tabs('option', 'active');
        }
    });
    });

    $('#itmCost').blur(function () {
        elem = $(this);
        setTotals();

    });


    $('#adchrCost').blur(function () {
        elem = $(this);
        setAddTotals();

    });
    $('#AdvancePayment').blur(function () {
        var balpay;
        var adpay;
        if ($('#AdvancePayment').val() != "") {
            adpay = parseFloat($('#AdvancePayment').val().replaceAll(",", ""));
            balpay = parseFloat($('#ordTotalCostVAT').val().replaceAll(",", "")) - adpay;
            console.log(balpay)
        }
        else {
            balpay = parseFloat($('#ordTotalCostVAT').val().replaceAll(",", "").replace(".00", ""))
            console.log(balpay)
        }

        $('#BalancePayment').val(number_format(balpay, 2, '.', ','));

    });
    $('#BalancePayment').blur(function () {
        var balpay;
        var adpay;
        if ($('#AdvancePayment').val() != "") {
            adpay = parseFloat($('#AdvancePayment').val().replaceAll(",", ""));
            balpay = parseFloat($('#ordTotalCostVAT').val().replaceAll(",", "")) - adpay;
            console.log(balpay)
        }
        else {
            balpay = parseFloat($('#ordTotalCostVAT').val().replaceAll(",", "").replace(".00", ""))
            console.log(balpay)
        }


        $('#BalancePayment').val(number_format(balpay, 2, '.', ','));

    });

    $("#OrderTotal").click(function () {
        var vatTot = 0;
        var ordtot = $('#OrdtotCost').val();
        var TotWithVat = 0;

        for (var i = 0; i < vatAmountArray.length; i++) {
            vatTot += parseFloat(parseFloat(vatAmountArray[i]))
        }

        $('#OrderTotal').val(number_format(parseFloat(OrderTotal(ordtot)), 2, '.', ','));
        $('#OrderVAT').val(number_format(parseFloat(vatTot), 2, '.', ','));
        TotWithVat += parseFloat(vatTot) + parseFloat(OrderTotal(ordtot))
        $('#ordTotalCostVAT').val(number_format(parseFloat(TotWithVat),2,'.',','));



    });
    var vatAmountArray = [];


    //Product summary table
    $("#product").click(function () {

        var productIdArray = [];
        var qtyArray = [];
        var  itmtotCostArray=[];
        var costArray = [];
        /*var vatPerArray = [];*/

        var totalcost=0;
        var TotVat = 0;
        var ordTot=0;

        var obj_list = document.querySelectorAll('[class*="form-row item m-t-10 m-b-20"]');

        $.each(obj_list, function (key, obj) {
            productIdArray.push($(obj).find('select#quoteItem_CategoryId option:selected').text());
            qtyArray.push($(obj).find('input#itmQty').val());
            costArray.push($(obj).find('input#itmCost').val().replaceAll(",", "").replace(".00",""));
            itmtotCostArray.push($(obj).find('input#itmTotalCost').val().replaceAll(",", "").replace(".00", ""));
           /* vatPerArray.push($(obj).find('input#VAT').val());*/

        });

        $('#sumtdata').empty();
        for (var i = 0; i < productIdArray.length; i++)
        {

            totalcost = totalcost + parseFloat(itmtotCostArray[i].replaceAll(",", "").replace(".00", ""));
            var attr = $("input#VAT").attr("disabled");

            if (typeof attr !== 'undefined' && attr !== false) {
                vatAmountArray[i] = 0.00;
            } else {

                vatAmountArray[i] = (parseFloat(itmtotCostArray[i].replaceAll(",", "").replace(".00", ""))) * (0.15);

            }
            TotVat += parseFloat(vatAmountArray[i]);
            var shownCost = number_format(parseFloat(costArray[i]), 2, '.', ',')
            var shownTotCost = number_format(parseFloat(itmtotCostArray[i]), 2, '.', ',')

            $('#sumtdata').append("<tr>" +
                "<td>" + productIdArray[i] + "</td>" +
                "<td>" + qtyArray[i] + "</td>" +
                "<td>" + shownCost + "</td>" +
                "<td>" + shownTotCost + "</td>" +"<tr>"
            );

        }


            ordTot += parseFloat(totalcost) + parseFloat(TotVat);





        $('#OrdtotCost').val(totalcost);
        $('#TotalCostVAT').val(number_format(parseFloat(ordTot),2,'.',','));
        $(".OrderVat").val(TotVat);
    });









    $(".order-type").change(function () {
        var code = $(".order-type option:selected").text();

        var sections = $('#Code').val().split("-");

        $('#Code').val(code + "-" + sections[1] + "-" + sections[2] + "-" + sections[3]);
    });



    $("#BaseQuoteId").change(function () {
        var qouteid = $('#BaseQuoteId').val();

        $.ajax({
            url: '/Order/Convert',
            //url: '/Order/Index',
            data: { "qouteid": qouteid },
            dataType: "json",
            contentType: 'application/json',
            method: 'GET',
            success: function (data) {



                var clientid = data.ClientId;
                var header = data.Header;
                var contactperson = data.ContactPerson;
                var contactnum = data.ContactMobile;
                var framework = data.FrameworkWarrantyPeriod;
                var warranty = data.LetteringWarrantyPeriod;
                var illumination = data.IlluminationWarrantyPeriod;

                var QuateItem = data.OrderItems;



                $('#ClientId').prop('selectedIndex', clientid);
                $('#Header').val(header);
                $('#ContactPerson').val(contactperson);
                $('#ContactMobile').val(contactnum);

                $('#item-count').val(QuateItem.length);

                for (var i = 0; i < QuateItem.length; i++)//see that I removed the $ preceeding the `for` keyword, it should not have been there
                {
                    if (i == 0) {


                        $('#quoteItem_CategoryId').prop('selectedIndex', QuateItem[i].CategoryId);
                        $('#quoteItem_VisibilityId').prop('selectedIndex', QuateItem[i].VisibilityId);
                        $('#quoteItem_FrameworkWarrantyPeriod').prop('selectedIndex', QuateItem[i].FrameworkWarrantyPeriod);
                        $('#quoteItem_LetteringWarrantyPeriod').prop('selectedIndex', QuateItem[i].LetteringWarrantyPeriod);
                        $('#quoteItem_IlluminationWarrantyPeriod').prop('selectedIndex', QuateItem[i].IlluminationWarrantyPeriod);
                        $('#itmQty').val(QuateItem[i].Qty);
                        $('#itmCost').val(QuateItem[i].UnitCost);
                        $('#itmTotalCost').val(QuateItem[i].TotalCost);
                        $('#Size').val(QuateItem[i].Size);
                        $('#Description').val(QuateItem[i].Description);
                        $('#Installation').val(QuateItem[i].Installation);



                    }
                    else {
                        var temp = $('.item:first').clone();
                        temp.find('input#itmQty').val(QuateItem[i].Qty);
                        temp.find('input#itmCost').val(QuateItem[i].UnitCost);
                        temp.find('input#itmTotalCost').val(QuateItem[i].TotalCost);
                        temp.find('input#Size').val(QuateItem[i].Size);
                        temp.find('select#quoteItem_CategoryId').prop('selectedIndex', QuateItem[i].CategoryId);
                        temp.find('select#quoteItem_VisibilityId').prop('selectedIndex', QuateItem[i].VisibilityId);
                        temp.find('select#quoteItem_FrameworkWarrantyPeriod').prop('selectedIndex', QuateItem[i].FrameworkWarrantyPeriod);
                        temp.find('select#quoteItem_LetteringWarrantyPeriod').prop('selectedIndex', QuateItem[i].LetteringWarrantyPeriod);
                        temp.find('select#quoteItem_IlluminationWarrantyPeriod').prop('selectedIndex', QuateItem[i].IlluminationWarrantyPeriod);

                        $('.item:last').after(temp);


                    }

                }



            },
            error: function (err) {
                alert("error section");
                console.log(err);
            }
        });


    });
    $(document).ready(function () {

        //Order Attachment
        $("#fileButton").click(function () {
            var files = $("#fileInput").get(0).files;
            var fileData = new FormData();

            for (var i = 0; i < files.length; i++) {
                fileData.append("fileInput", files[i]);
            }

            $.ajax({
                type: "POST",
                url: "/Order/UploadFiles",
                dataType: "json",
                contentType: false, // Not to set any content header
                processData: false, // Not to process data
                data: fileData,
                success: function (result, status, xhr) {
                    alert(result);
                },
                error: function (xhr, status, error) {
                    alert(status);
                }
            });
        });

        $(".datepicker").datepicker({
            dateformat: "dd-mm-yy",
            changemonth: true,
            changeyear: true
        });

        $(window).keydown(function (event) {
            if ((event.which == 13) && ($(event.target)[0] != $("textarea")[0])) {
                event.preventDefault();
                return false;
            }
        });

        var d = new Date();
        var today = new Date((d.getFullYear(), d.getMonth(), d.getDate()) + 'T00:00:00Z');
        $("#Version").val("1");
        var formattedNumber = ("0" + (d.getMonth() + 1)).slice(-2);
        $("#Month").val(formattedNumber);
        var year = d.getFullYear().toString().substring(2, 4);
        $("#Year").val(year);
        $("#CreatedDate").val(d.getDate() + "-" + formattedNumber + "-" + year);

        $('#IsVAT').change(function () {
            setTotals();
            if ($(this).is(":checked")) {
                $('#Code').val($('#Code').val().replace('STA-', 'ST-'));
            }
            else {
                $('#Code').val($('#Code').val().replace('ST-', 'STA-'));
            }
        });


        //Clone Items  textboxes
        $('#add').click(function () {
            var n = $('.item').length + 1;
            var temp = $('.item:first').clone();
            /*var cln = temp.find("#itemId")*/
            var clnIn = temp.find("#itemId")
            clnIn.val(0);
            $('.item:last').after(temp);
            $('#item-count').val(parseInt($('#item-count').val()) + 1);

        });

        //Clone Additional charges textboxes
        $('#AddChr').click(function () {


            var n = $('.addcharge').length + 1;
            var temp = $('.addcharge:first').clone();
            var cln = temp.find("#withHidden")
            var clnIn = cln.find("#AddchrgId")
            clnIn.val(0);
           // clnIn.value(0);

            //label.value = 0;/*input#AddchrgId.form - control*/

            $('.addcharge:last').after(temp);
            $('#charge-count').val(parseInt($('#charge-count').val()) + 1);
        });

        //Clone Materials  textboxes
        $('#AddMat').click(function () {


            var n = $('.materials').length + 1;
            var temp = $('.materials:first').clone();
            var temp = $('.materials:first').clone();
            var cln = temp.find("#withHidden")
            var clnIn = cln.find("#ordmatrId")
            clnIn.val(0);
            // clnIn.value(0);

            //label.value = 0;/*input#AddchrgId.form - control*/

            $('.materials:last').after(temp);
            $('#material-count').val(parseInt($('#material-count').val()) + 1);
        });





        //Advanced payment
        $('#AdvancePayment').change(function () {

            // alert($('#hidden-1005').val());
            var y = $('#hidden-1005').val().replace("{payment}", $('#AdvancePayment').val());
            $('#term-1005').text(y);

            var y = $('#hidden-1').val().replace("{payment}", $('#AdvancePayment').val());
            $('#term-1').text(y);

        });

        //power supply
        $('#PowerSupplyAmp').change(function () {

            var y = $('#hidden-1003').val().replace("{amp}", $('#PowerSupplyAmp').val());
            $('#term-1003').text(y);

        });

        //valid days
        $('#ValidDays').change(function () {

            var y = $('#hidden-2').val().replace("{Validity}", $('#ValidDays').val());
            $('#term-2').text(y);

        });

        //delivery period
        $('#DeliveryPeriod').change(function () {

            var y = $('#hidden-1005').val().replace("{delivery}", $('#DeliveryPeriod').val());
            $('#term-1005').text(y);

        });

        $(document).on("change", "select#quoteItem_CategoryId", function () {
            elem = $(this);
            var des = $(elem).parent().parent('div').find('select#quoteItem_CategoryId option:selected').val();

            var obj = { Id: des };
            AjaxCall('/Order/GetatDesc', JSON.stringify(obj), 'POST').done(function (response) {
                if (response.length > 0) {
                    $(elem).parent().parent('div').find('textarea#Description').val(response);
                }
            }).fail(function (error) {
                alert(error.StatusText);
            });
        });

        $(document).on("change", "select#ClientId", function () {
            elem = $(this);
            var obj = { id: $(elem).val() };
            AjaxCall('/Client/GetClientById', JSON.stringify(obj), 'POST').done(function (response) {
                $('#ContactPerson').val(response.CPName);
                $('#ContactMobile').val(response.CPMobile);
            }).fail(function (error) {
                alert(error.StatusText);
            });
        });



        $(document).on("change", "input#itmQty", function () {
            elem = $(this);
            setTotals();
        });

        $(document).on("change", "input#itmCost", function () {
            elem = $(this);
            setTotals();
        });
        $(document).on("change", "input#VAT", function () {
            elem = $(this);
            setTotals();
        });


        $(document).on("change", "input#adchrQty", function () {
            elem = $(this);
            setAddTotals();
        });

        $(document).on("change", "input#adchrCost", function () {
            elem = $(this);
            setAddTotals();
        });

        //$(document).on("change", "select#quoteItem_CategoryId", function () {
        //  elem = $(this);
        //   productChange();
        //});






    })

    function AjaxCall(url, data, type) {
        return $.ajax({
            url: url,
            type: type ? type : 'GET',
            data: data,
            contentType: 'application/json'
        });
    }

    function productChange() {
        var des = $(elem).parent().parent('div').find('select#quoteItem_CategoryId option:selected').val();

        var des= $.ajax({
            url: url,
            type: type ? type : 'GET',
            data: data,
            contentType: 'application/json'
        });

        $(elem).parent().parent('div').find('textarea#Description').val(des);

    }


    function setTotals() {
        var qty = $(elem).parent().parent('div').find('input#itmQty').val();
        var cost = $(elem).parent().parent('div').find('input#itmCost').val().replaceAll(",", "").replace(".00","");
        var VATPercentage=15;
        var Total = (parseFloat(qty)) * (parseFloat(cost));

        if (isNaN(Total)) {
            Total = 0;
        }
        if (isNaN(VATPercentage)) {
            VATPercentage = 15;
        }
        var VAT=0;

        var attr = $('input#VAT').prop('disabled');
        if (typeof attr !== 'undefined' && attr !== false) {
            VAT = 0.00;

        } else {
            VAT = (parseFloat(Total) * parseFloat(VATPercentage)) / 100;
        }


        var TotalWithVAT = parseFloat(Total) + parseFloat(VAT);

        $(elem).parent().parent('div').find('input#itmTotalCost').val(number_format(parseFloat(Total),2,'.',','));
        (elem).parent().parent('div').find('input#VAT').val(number_format(parseFloat(VAT), 2, '.', ','));
        $(elem).parent().parent('div').find('input#TotalCostVAT').val(number_format(TotalWithVAT, 2, '.', ','));

    }

    //----------------------------------------------
    function setAddTotals() {
        var qty = $(elem).parent().parent('div').find('input#adchrQty').val();
        var cost = $(elem).parent().parent('div').find('input#adchrCost').val().replace(",","").replace(".00","");

        var TotalWithVAT = $(elem).parent().parent('div').find('input#OrdtotCost').val()

        for (var i = 0; i < vatAmountArray.length; i++) {
            TotalWithVAT += parseFloat(vatAmountArray[i]);
        }
        if (isNaN(Total)) {
            Total = 0;
        }
        $(elem).parent().parent('div').find('input#ordTotalCostVAT').val(number_format(TotalWithVAT, 2, '.', ','));
        var Total = parseFloat(qty) * parseFloat(cost);



        $(elem).parent().parent('div').find('input#adchrTotalCost').val(number_format(Total, 2, '.', ','));


    }





    number_format = function (number, decimals, dec_point, thousands_sep) {
        number = number.toFixed(decimals);

        var nstr = number.toString();
        nstr += '';
        x = nstr.split('.');
        x1 = x[0];
        x2 = x.length > 1 ? dec_point + x[1] : '';
        var rgx = /(\d+)(\d{3})/;

        while (rgx.test(x1))
            x1 = x1.replace(rgx, '$1' + thousands_sep + '$2');

        return x1 + x2;
    }



    function readValues() {




        var productIdArray = [];
        var itmqtyArray = [];
        var descriptionArray = [];
        var itmcostArray = [];
        var itmtotCostArray = [];
        var vatArray = [];
        var sizeArray = [];
        var chargeItemArray = [];
        var chargeQtyArray = [];
        var chargeCostArray = [];
        var illuminationArray = [];
        var visibilityArray = [];
        var frameworkWarrantyArray = [];
        var letteringWarrantyArray = [];
        var illuminationWarrantyArray = [];
        var chargeTotalCostArray = [];
        var SpecialInstructionsArray = [];
        var installationArray = [];
        var channeledByArray = [];
        var AttachmentNameArray = [];
        var MatAttachmentNameArray = [];
        var itemIdArray = [];
        var addchrgIdArray = [];

        var MaterialIdArray = [];
        var MaterialArr = []
        var SupplierArr = [];
        var AttributeArr = [];
        var ValueArr = [];

        var obj_list = document.querySelectorAll('[class*="form-row item m-t-10 m-b-20"]');

        $.each(obj_list, function (key, obj) {
            itemIdArray.push($(obj).find('input#itemId').val());

            productIdArray.push($(obj).find('select#quoteItem_CategoryId').val());
            itmqtyArray.push($(obj).find('input#itmQty').val());
            descriptionArray.push($(obj).find('textarea#Description').val().replaceAll(",", ";"));
            SpecialInstructionsArray.push($(obj).find('input#SpecialInstructions').val());
            installationArray.push($(obj).find('input#Installation').val());
            itmcostArray.push($(obj).find('input#itmCost').val().replaceAll(",","").replace(".00",""));
            itmtotCostArray.push($(obj).find('input#itmTotalCost').val().replaceAll(",", "").replace(".00", ""));
            vatArray.push($(obj).find('input#VAT').val().replace(",",""));
            sizeArray.push($(obj).find('input#Size').val());
            illuminationArray.push($(obj).find('select#quoteItem_Illumination').val());

            visibilityArray.push($(obj).find('select#quoteItem_VisibilityId').val());
            frameworkWarrantyArray.push($(obj).find('select#quoteItem_FrameworkWarrantyPeriod').val());
            letteringWarrantyArray.push($(obj).find('select#quoteItem_LetteringWarrantyPeriod').val());
            illuminationWarrantyArray.push($(obj).find('select#quoteItem_IlluminationWarrantyPeriod').val());
            channeledByArray.push($(obj).find('select#ChanneledBy').val());



        });

        $('#itemIdArray').val(itemIdArray);
        $('#productIdArray').val(productIdArray);
        $('#itmqtyArray').val(itmqtyArray);
        $('#descriptionArray').val(descriptionArray);
        $('#SpecialInstructionsArray').val(SpecialInstructionsArray);
        $('#installationArray').val(installationArray);
        $('#itmcostArray').val(itmcostArray);
        $('#itmtotCostArray').val(itmtotCostArray);
        $('#vatArray').val(vatArray);
        $('#sizeArray').val(sizeArray);
        $('#illuminationArray').val(illuminationArray);
        $('#visibilityArray').val(visibilityArray);
        $('#letteringWarrantyArray').val(letteringWarrantyArray);
        $('#frameworkWarrantyArray').val(frameworkWarrantyArray);
        $('#illuminationWarrantyArray').val(illuminationWarrantyArray);
        $('#channeledByArray').val(channeledByArray);


        var chrg_list = document.querySelectorAll('[class*="form-row addcharge"]');
        $.each(chrg_list, function (key, obj) {
            addchrgIdArray.push($(obj).find('input#AddchrgId').val());
            chargeItemArray.push($(obj).find('input#adchrItem').val());
            chargeCostArray.push($(obj).find('input#adchrCost').val().replace(",","").replace(".00",""));
            chargeQtyArray.push($(obj).find('input#adchrQty').val());
            chargeTotalCostArray.push($(obj).find('input#adchrTotalCost').val().replaceAll(",", "").replace(".00", ""));

        });

        $('#chargeTotalCostArray').val(chargeTotalCostArray);
        $('#addchrgIdArray').val(addchrgIdArray);
        $('#chargeItemArray').val(chargeItemArray);
        $('#chargeCostArray').val(chargeCostArray);
        $('#chargeQtyArray').val(chargeQtyArray);

        //Order Attachements
        var attachment_list = document.querySelectorAll('[class*="form-row attachement"]');
        $.each(attachment_list, function (key, obj) {
            AttachmentNameArray.push($(obj).find('input#actfilename').val());


        });
        $('#AttachmentNameArray').val(AttachmentNameArray);

        //Material Files
        var Matattachment_list = document.querySelectorAll('[class*="form-row material-attachment"]');
        $.each(Matattachment_list, function (key, obj) {
            MatAttachmentNameArray.push($(obj).find('input#InstalActfilename').val());


        });
        $('#MatAttachmentNameArray').val(MatAttachmentNameArray);

        var mat_list = document.querySelectorAll('[class*="form-row materials"]');
        $.each(mat_list, function (key, obj) {
            MaterialIdArray.push($(obj).find('input#ordmatrId').val());
            MaterialArr.push($(obj).find('select#ordermat_MaterialId').val());
            SupplierArr.push($(obj).find('select#ordermat_SupplierId').val());
            AttributeArr.push($(obj).find('input#ordermat_AttributeId').val());
            ValueArr.push($(obj).find('input#ordmatVal').val());

        });
        $('#ordmatIdArray').val(MaterialIdArray);
        $('#MaterialArr').val(MaterialArr);
        $('#SupplierArr').val(SupplierArr);
        $('#AttributeArr').val(AttributeArr);
        $('#ValueArr').val(ValueArr);



        return true;



    }



</script>
<link href="~/Content/themes/base/jquery-ui.css" rel="stylesheet" />
@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")
    <script src="~/Scripts/jquery-ui-1.13.2.js"></script>
}
