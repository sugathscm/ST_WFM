@{
    ViewBag.Title = "Invoice";
}

<style>

    @@media screen {
        #printSection {
            display: none;
        }
    }

    @@media (min-width: 992px) {
        .modal-dialog {
            max-width: 60%;
        }
    }

    @@media print {
        body * {
            visibility: hidden;
        }

        #printSection, #printSection * {
            visibility: visible;
        }

        #printSection {
            position: absolute;
            left: 10px;
            top: 0;
        }
    }

    table.report-container {
        page-break-after: always;
    }

    thead.report-header {
        display: table-header-group;
    }

    tfoot.report-footer {
        display: table-footer-group;
    }

    tr {
        page-break-inside: avoid;
        page-break-after: auto
    }
</style>
<sty>
    <div class="dashboard-ecommerce">
        <div class="container-fluid dashboard-content ">
            <div class="row">
                <div class="col-xl-2 col-lg-2 col-md-12 col-sm-12 col-8">
                    <div class="page-header">
                        <h2 class="pageheader-title">Invoice</h2>
                    </div>
                </div>

            </div>

            <div class="border border-primary bg-actual-white">
             
            </div>
            <br />
         
            @if (User.IsInRole("Administrator") || User.IsInRole("Factory") || User.IsInRole("Sales") || User.IsInRole("Management") || User.IsInRole("Design") || User.IsInRole("Department"))
            {<br />
                <h3>Invoices</h3>
                <div class="border border-primary bg-actual-white m-t-20">
                    <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12 m-t-20  m-b-20">
                      
                        <div class="table-responsive">

                            <table id="List" class="table table-striped table-bordered first">
                                <thead>
                                    <tr>
                                        <th>Invoice No</th>
                                        <th>Order No</th>
                                        <th>Client</th>
                                        <th>Created Date</th>
                                        <th></th>
                                    </tr>
                                </thead>
                            </table>

                        </div>

                    </div>
                </div>
            }
            else
            {
                <div style="display:flex;justify-content:center;min-height:3.5rem;padding:1.2rem 0 1rem 0;background-color:white;border-radius:10px;">
                    <h2 style="font-size:3rem;">Please Login to the system.</h2>
                </div>
            }
        
        </div>
        
    </div>

    <div class="modal fade" id="reportModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                  
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body" id="Preview">
                   
                </div>
                <div class="modal-footer">

                    <button id="btnPrint" type="button" class="btn btn-primary">Print</button>
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
    <script>
    $(document).ready(function () {

            LoadInvoices();

    });


        document.getElementById("btnPrint").onclick = function () {
            printElement(document.getElementById("printThis"));
        }



    function printElement(elem) {
        var domClone = elem.cloneNode(true);
        
        var $printSection = document.getElementById("printSection");

        if (!$printSection) {
            var $printSection = document.createElement("div");
            //$printSection.style.width = "100vw";
            //$printSection.style.height = "100vh";
            //$printSection.style.paddingRight = "1rem";
            //$printSection.style.marginLeft = "none";
            //$printSection.classList="relative "
            $printSection.id = "printSection";
            document.body.appendChild($printSection);
        }
       
        //var topDetails = domClone.querySelector("#topDetails");
        //if (topDetails) {
        //    topDetails.style.marginTop = "2rem"
        //    topDetails.style.marginBottom="10rem"
        //}
        //var totals = domClone.querySelector("#totalsBox")
        //if (totals) {
        //    totals.style.marginTop = "5rem"
        //    totals.style.paddingRight="2rem"
        //}
        //var redBar = document.createElement("div");
        //redBar.style.position = "fixed";
        //redBar.style.bottom = "0";
        //redBar.style.left = "0";
        //redBar.style.width = "100vw";
        //redBar.style.height = "20px";
        //redBar.style.background = "red";
        //redBar.style.zIndex = "9999";

        $printSection.innerHTML = "";
        $printSection.appendChild(domClone);
        $printSection.appendChild(redBar);
        //$imgdiv.appendChild($img)
        //$printSection.appendChild($imgdiv)

        
        
        window.print();
        }


    function PrintInvoice(id) {
        $.ajax({
            type: "GET",
            url: '@Url.Action("PrintInvoice", "Invoice")',
            data: { id: id },
            success: function (data) {
                $('#Preview').html(data);
                $('#reportModal').modal('show');
            }
        })
    }

     function LoadInvoices() {

        if ($.fn.dataTable.isDataTable('#List')) {
            table = $('#List').DataTable();
            table.destroy();
        }

        $('#List').DataTable({
            "ordering": false,
            "createdRow": function (row, data, dataIndex) {

            },
            "ajax": {
                "url": "/Invoice/GetList",
                "type": "POST",
                "datatype": "json"
            },
            "columns": [
                { "data": "Code", "width": "20%", "ordering": false, "sorting": false },
                { "data": "OrderCode", "width": "20%", "ordering": false, "sorting": false },
                { "data": "ClientName", "width": "20%", "ordering": false, "sorting": false },
                { "data": "CreatedDateString", "width": "20%", "ordering": false, "sorting": false },
                {
                    "data": "Id", "searchable": false, "ordering": false, "sorting": false,
                    "render": function (data, type, full, meta) {
                        return '<a class="btn btn-secondary btn-xs" onclick="PrintInvoice(' + data + ')">View</a>';
                    }
                },

            ]
        });

    }
    </script>
